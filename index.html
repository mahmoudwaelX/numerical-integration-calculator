<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Numerical Integration Calculator</title>
		<style>
			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				margin: 0;
				padding: 0;
				min-height: 100vh;
				display: flex;
				justify-content: center;
				align-items: center;
				color: #333;
				overflow: auto;
				position: relative;
				background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
				background-size: 400% 400%;
				animation: gradient 8s ease infinite;
			}

			@keyframes gradient {
				0% {
					background-position: 0% 50%;
				}
				50% {
					background-position: 100% 50%;
				}
				100% {
					background-position: 0% 50%;
				}
			}

			.calculator-container {
				background-color: rgba(255, 255, 255, 0.85);
				border-radius: 15px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
				width: 90%;
				max-width: 600px;
				padding: 30px;
				margin: 40px 0;
				backdrop-filter: blur(5px);
				border: 1px solid rgba(255, 255, 255, 0.3);
			}

			h1 {
				text-align: center;
				color: #2c3e50;
				margin-bottom: 30px;
				font-weight: 600;
				text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
			}

			.input-group {
				margin-bottom: 20px;
			}

			label {
				display: block;
				margin-bottom: 8px;
				font-weight: 500;
				color: #2c3e50;
			}

			input,
			select {
				flex: 1;
				padding: 12px;
				border: 2px solid rgba(44, 62, 80, 0.2);
				border-radius: 8px;
				font-size: 16px;
				transition: all 0.3s;
				background-color: rgba(255, 255, 255, 0.8);
			}

			input:focus,
			select:focus {
				border-color: #3498db;
				outline: none;
				box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
			}

			.input-group {
				width: 100%;
				display: flex;
				justify-content: space-between;
				flex-direction: column;
				gap: 6px;
			}

			.method-selection {
				display: flex;
				gap: 15px;
				margin-bottom: 20px;
			}

			.method-option {
				flex: 1;
				text-align: center;
			}

			.method-option input {
				display: none;
			}

			.method-option label {
				display: block;
				padding: 12px;
				background-color: rgba(44, 62, 80, 0.1);
				border-radius: 8px;
				cursor: pointer;
				transition: all 0.3s;
			}

			.method-option input:checked + label {
				background-color: #3498db;
				color: white;
			}

			.button-group {
				display: flex;
				gap: 15px;
				margin-top: 30px;
			}

			button {
				flex: 1;
				padding: 12px;
				border: none;
				border-radius: 8px;
				font-size: 16px;
				font-weight: 500;
				cursor: pointer;
				transition: all 0.3s;
			}

			.calculate-btn {
				background-color: #2c3e50;
				color: white;
			}

			.calculate-btn:hover {
				background-color: #1a252f;
				transform: translateY(-2px);
			}

			.reset-btn {
				background-color: #e74c3c;
				color: white;
			}

			.reset-btn:hover {
				background-color: #c0392b;
				transform: translateY(-2px);
			}

			.calculate-both-btn {
				background-color: #27ae60;
				color: white;
			}

			.calculate-both-btn:hover {
				background-color: #219653;
				transform: translateY(-2px);
			}

			.result-container {
				margin-top: 30px;
				padding: 20px;
				background-color: rgba(44, 62, 80, 0.1);
				border-radius: 8px;
				display: none;
				animation: fadeIn 0.5s ease-out;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.result-title {
				font-weight: 600;
				color: #2c3e50;
				margin-bottom: 10px;
			}

			.result-value {
				font-size: 18px;
				font-weight: 500;
				color: #2c3e50;
				margin: 8px 0;
			}

			.result-value strong {
				color: #3498db;
			}

			.example {
				margin-top: 20px;
				font-size: 14px;
				color: #7f8c8d;
			}

			.example-title {
				font-weight: 500;
				margin-bottom: 5px;
				color: #2c3e50;
			}

			.ready-equations {
				margin-bottom: 20px;
			}

			.ready-eq-btn {
				background-color: rgba(44, 62, 80, 0.1);
				color: #2c3e50;
				margin-bottom: 5px;
				padding: 8px 12px;
				border-radius: 5px;
				font-size: 14px;
				border: none;
				cursor: pointer;
				transition: all 0.2s;
			}

			.ready-eq-btn:hover {
				background-color: rgba(52, 152, 219, 0.2);
				transform: translateY(-1px);
			}

			.supervisors {
				text-align: center;
				margin-top: 30px;
				font-size: 14px;
				color: #2c3e50;
				padding: 15px;
				background-color: rgba(255, 255, 255, 0.7);
				border-radius: 8px;
			}

			@media (max-width: 480px) {
				.method-selection,
				.button-group {
					flex-direction: column;
				}

				.calculator-container {
					padding: 20px;
				}
			}
		</style>
	</head>
	<body>
		<div class="calculator-container">
			<h1>Numerical Integration Calculator</h1>

			<div class="ready-equations">
				<label>Ready Equations:</label>
				<div
					style="
						display: grid;
						grid-template-columns: repeat(2, 1fr);
						gap: 10px;
					"
				>
					<button class="ready-eq-btn" onclick="setReadyEquation('sin(x)')">
						sin(x)
					</button>
					<button class="ready-eq-btn" onclick="setReadyEquation('cos(x)')">
						cos(x)
					</button>
					<button class="ready-eq-btn" onclick="setReadyEquation('x^2')">
						x²
					</button>
					<button class="ready-eq-btn" onclick="setReadyEquation('x^3')">
						x³
					</button>
					<button class="ready-eq-btn" onclick="setReadyEquation('exp(x)')">
						eˣ
					</button>
					<button class="ready-eq-btn" onclick="setReadyEquation('log(x)')">
						ln(x)
					</button>
					<button class="ready-eq-btn" onclick="setReadyEquation('sqrt(x)')">
						√x
					</button>
					<button class="ready-eq-btn" onclick="setReadyEquation('1/(1+x^2)')">
						1/(1+x²)
					</button>
				</div>
			</div>

			<div class="input-group">
				<label for="function">Enter Function (e.g., sin(x) + x^2):</label>
				<input type="text" id="function" placeholder="e.g., sin(x) + x^2" />
			</div>

			<div
				class="input-row"
				style="display: flex; flex-direction: column; gap: 10px"
			>
				<div class="input-group" style="flex: 1; width: 100%">
					<label for="lower-limit">Lower Limit (a):</label>
					<input id="lower-limit" type="number" placeholder="e.g., 0" />
				</div>

				<div class="input-group" style="flex: 1; width: 100%">
					<label for="upper-limit">Upper Limit (b):</label>
					<input id="upper-limit" type="number" placeholder="e.g., 1" />
				</div>
			</div>

			<div class="input-group">
				<label for="intervals">Number of Intervals (n):</label>
				<input
					type="number"
					id="intervals"
					placeholder="e.g., 100"
					min="1"
					style="max-width: 100%"
				/>
			</div>

			<div class="method-selection">
				<div class="method-option">
					<input
						type="radio"
						id="trapezoidal"
						name="method"
						value="trapezoidal"
						checked
					/>
					<label for="trapezoidal">Trapezoidal Rule</label>
				</div>
				<div class="method-option">
					<input type="radio" id="simpsons" name="method" value="simpsons" />
					<label for="simpsons">Simpson's Rule</label>
				</div>
			</div>

			<div class="button-group">
				<button class="calculate-btn" id="calculate">Calculate</button>
				<button class="calculate-both-btn" id="calculate-both">
					Calculate Both
				</button>
				<button class="reset-btn" id="reset">Reset</button>
			</div>

			<div class="result-container" id="result-container">
				<div class="result-title">Calculation Results:</div>
				<div id="result-content"></div>
			</div>

			<div class="example">
				<div class="example-title">Example Functions:</div>
				<div>sin(x), cos(x), tan(x), log(x), exp(x), sqrt(x), x^2, etc.</div>
				<div>Use * for multiplication (e.g., 2*x)</div>
				<div>Use parentheses for grouping (e.g., (x+1)/(x-1))</div>
			</div>

			<div class="supervisors">
				Supervised by:<br />
				Dr. Alaa Maghawry<br />
				Dr. Abdelrhman Reyad
			</div>
		</div>

		<script>
			// Global x value
			let x_value;

			// Convert to uppercase
			function toUpper(s) {
				return s.toUpperCase();
			}

			// Expression parser class
			class ExpressionParser {
				constructor(expr) {
					this.expr = expr;
					this.pos = 0;
				}

				parse() {
					this.pos = 0;
					return this.parseExpression();
				}

				parseExpression() {
					let result = this.parseTerm();
					while (this.pos < this.expr.length) {
						if (this.expr[this.pos] === "+") {
							this.pos++;
							result += this.parseTerm();
						} else if (this.expr[this.pos] === "-") {
							this.pos++;
							result -= this.parseTerm();
						} else break;
					}
					return result;
				}

				parseTerm() {
					let result = this.parseFactor();
					while (this.pos < this.expr.length) {
						if (this.expr[this.pos] === "*") {
							this.pos++;
							result *= this.parseFactor();
						} else if (this.expr[this.pos] === "/") {
							this.pos++;
							result /= this.parseFactor();
						} else break;
					}
					return result;
				}

				parseFactor() {
					let result = this.parsePrimary();
					while (this.pos < this.expr.length && this.expr[this.pos] === "^") {
						this.pos++;
						result = Math.pow(result, this.parsePrimary());
					}
					return result;
				}

				parsePrimary() {
					while (this.pos < this.expr.length && this.expr[this.pos] === " ")
						this.pos++;

					if (this.pos < this.expr.length && this.expr[this.pos] === "(") {
						this.pos++;
						let result = this.parseExpression();
						if (this.pos < this.expr.length && this.expr[this.pos] === ")")
							this.pos++;
						return result;
					}

					if (/[a-zA-Z]/.test(this.expr[this.pos])) {
						let name = "";
						while (
							this.pos < this.expr.length &&
							/[a-zA-Z]/.test(this.expr[this.pos])
						) {
							name += this.expr[this.pos++];
						}

						name = toUpper(name);
						if (name === "X") return x_value;

						let arg;
						if (this.pos < this.expr.length && this.expr[this.pos] === "(") {
							this.pos++;
							arg = this.parseExpression();
							if (this.pos < this.expr.length && this.expr[this.pos] === ")")
								this.pos++;
						} else {
							arg = this.parsePrimary();
						}

						if (name === "SIN") return Math.sin(arg);
						if (name === "COS") return Math.cos(arg);
						if (name === "TAN") return Math.tan(arg);
						if (name === "LOG" || name === "LN") return Math.log(arg);
						if (name === "EXP") return Math.exp(arg);
						if (name === "SQRT") return Math.sqrt(arg);

						throw new Error("Unknown function: " + name);
					}

					let num = "";
					while (
						this.pos < this.expr.length &&
						(/[0-9]/.test(this.expr[this.pos]) || this.expr[this.pos] === ".")
					) {
						num += this.expr[this.pos++];
					}

					if (num === "") {
						throw new Error("Unexpected character at position " + this.pos);
					}

					return parseFloat(num);
				}
			}

			// Evaluate function at x
			function evaluate(func, x) {
				x_value = x;
				const parser = new ExpressionParser(func);
				return parser.parse();
			}

			// Trapezoidal rule
			function trapezoidal(func, a, b, n) {
				const h = (b - a) / n;
				let result = evaluate(func, a) + evaluate(func, b);

				for (let i = 1; i < n; ++i) {
					const x = a + i * h;
					result += 2 * evaluate(func, x);
				}

				return {
					value: result * (h / 2.0),
					h: h,
					error: Math.abs(
						((h * h * (b - a)) / 12) *
							Math.max(Math.abs(evaluate(func, a)), Math.abs(evaluate(func, b)))
					),
				};
			}

			// Simpson's 1/3 rule
			function simpsons_13(func, a, b, n) {
				if (n % 2 !== 0) n++; // Simpson's 1/3 requires even number of intervals

				const h = (b - a) / n;
				let result = evaluate(func, a) + evaluate(func, b);

				for (let i = 1; i < n; i += 2) {
					const x = a + i * h;
					result += 4 * evaluate(func, x);
				}

				for (let i = 2; i < n - 1; i += 2) {
					const x = a + i * h;
					result += 2 * evaluate(func, x);
				}

				return {
					value: result * (h / 3.0),
					h: h,
					error: Math.abs(
						((h * h * h * h * (b - a)) / 180) *
							Math.max(Math.abs(evaluate(func, a)), Math.abs(evaluate(func, b)))
					),
				};
			}

			// Simpson's 3/8 rule
			function simpsons_38(func, a, b, n) {
				if (n % 3 !== 0) n++; // Simpson's 3/8 requires n divisible by 3

				const h = (b - a) / n;
				let result = evaluate(func, a) + evaluate(func, b);

				for (let i = 1; i < n; i += 3) {
					const x = a + i * h;
					result += 3 * evaluate(func, x);
				}

				for (let i = 2; i < n - 1; i += 3) {
					const x = a + i * h;
					result += 3 * evaluate(func, x);
				}

				for (let i = 3; i < n - 2; i += 3) {
					const x = a + i * h;
					result += 2 * evaluate(func, x);
				}

				return {
					value: result * ((3 * h) / 8.0),
					h: h,
					error: Math.abs(
						((h * h * h * h * (b - a)) / 80) *
							Math.max(Math.abs(evaluate(func, a)), Math.abs(evaluate(func, b)))
					),
				};
			}

			// Choose best Simpson's method based on n
			function choose_best_simpsons(func, a, b, n) {
				if (n % 2 === 0) {
					return simpsons_13(func, a, b, n);
				} else if (n % 3 === 0) {
					return simpsons_38(func, a, b, n);
				} else {
					const res13 = simpsons_13(func, a, b, n);
					const res38 = simpsons_38(func, a, b, n);
					return {
						value: (res13.value + res38.value) / 2,
						h: res13.h,
						error: (res13.error + res38.error) / 2,
					};
				}
			}

			// Set ready equation
			function setReadyEquation(equation) {
				document.getElementById("function").value = equation;
				return false;
			}

			// Format result display
			function formatResult(method, result) {
				return `
			        <div class="result-value">
			            <strong>${method}:</strong> ${result.value.toFixed(6)}
			        </div>
			        <div class="result-value">
			            <strong>Step size (h):</strong> ${result.h.toFixed(
										6
									)} (width of each interval)
			        </div>
			        <div class="result-value">
			            <strong>Estimated Error:</strong> ${result.error.toFixed(
										6
									)} (approximation error bound)
			        </div>
			    `;
			}

			// DOM elements
			const calculateBtn = document.getElementById("calculate");
			const calculateBothBtn = document.getElementById("calculate-both");
			const resetBtn = document.getElementById("reset");
			const resultContainer = document.getElementById("result-container");
			const resultContent = document.getElementById("result-content");

			// Calculate button click handler
			calculateBtn.addEventListener("click", function () {
				try {
					const func = document.getElementById("function").value;
					const a = parseFloat(document.getElementById("lower-limit").value);
					const b = parseFloat(document.getElementById("upper-limit").value);
					const n = parseInt(document.getElementById("intervals").value);
					const method = document.querySelector(
						'input[name="method"]:checked'
					).value;

					if (!func || isNaN(a) || isNaN(b) || isNaN(n) || n < 1) {
						throw new Error("Please fill in all fields with valid values");
					}

					let result;
					let methodName;

					if (method === "trapezoidal") {
						result = trapezoidal(func, a, b, n);
						methodName = "Trapezoidal Rule Result";
					} else if (method === "simpsons") {
						result = choose_best_simpsons(func, a, b, n);
						methodName =
							n % 2 === 0
								? "Simpson's 1/3 Rule Result"
								: n % 3 === 0
								? "Simpson's 3/8 Rule Result"
								: "Combined Simpson's Rule Result";
					} else {
						throw new Error("Invalid method selected");
					}

					resultContent.innerHTML = formatResult(methodName, result);
					resultContainer.style.display = "block";
				} catch (error) {
					alert("Error: " + error.message);
					console.error(error);
				}
			});

			// Calculate Both button click handler
			calculateBothBtn.addEventListener("click", function () {
				try {
					const func = document.getElementById("function").value;
					const a = parseFloat(document.getElementById("lower-limit").value);
					const b = parseFloat(document.getElementById("upper-limit").value);
					const n = parseInt(document.getElementById("intervals").value);

					if (!func || isNaN(a) || isNaN(b) || isNaN(n) || n < 1) {
						throw new Error("Please fill in all fields with valid values");
					}

					const trapResult = trapezoidal(func, a, b, n);
					const simpResult = choose_best_simpsons(func, a, b, n);

					resultContent.innerHTML = `
			            ${formatResult("Trapezoidal Rule", trapResult)}
			            <hr style="margin: 15px 0; border: 0; border-top: 1px solid rgba(44, 62, 80, 0.2);">
			            ${formatResult(
										n % 2 === 0
											? "Simpson's 1/3 Rule"
											: n % 3 === 0
											? "Simpson's 3/8 Rule"
											: "Combined Simpson's Rule",
										simpResult
									)}
			        `;
					resultContainer.style.display = "block";
				} catch (error) {
					alert("Error: " + error.message);
					console.error(error);
				}
			});

			// Reset button click handler
			resetBtn.addEventListener("click", function () {
				document.getElementById("function").value = "";
				document.getElementById("lower-limit").value = "";
				document.getElementById("upper-limit").value = "";
				document.getElementById("intervals").value = "";
				document.getElementById("trapezoidal").checked = true;
				resultContainer.style.display = "none";
			});

			// Initialize ready equation buttons
			document.querySelectorAll(".ready-eq-btn").forEach((btn) => {
				btn.addEventListener("click", function () {
					const equation = this.getAttribute("onclick").match(/'([^']+)'/)[1];
					setReadyEquation(equation);
				});
			});
		</script>
	</body>
</html>
